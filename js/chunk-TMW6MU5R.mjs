import{a as Fe,b as Ue}from"chunk-2DKVEWZL.mjs";import{Fe as Me,Ge as re}from"chunk-TO3PG6NS.mjs";import{a as G}from"chunk-LDL4GN3P.mjs";import{b as J}from"chunk-YQXRHNKK.mjs";import{j as Q}from"chunk-5QQ5KTFK.mjs";import{da as De}from"chunk-VHBQVA4D.mjs";import{d as Ne}from"chunk-ID3FOPOK.mjs";import{Oe as we,lg as We,xb as Ve,zf as Be}from"chunk-BMVMSSVG.mjs";import{Lf as ke,if as Ce}from"chunk-G5CI4O4F.mjs";import{a as Pe,b as Le}from"chunk-SOM3QFWS.mjs";import{Ar as D,Dk as Ie,Dr as Se,Ir as oe,Mr as ve,Uh as ge,Zj as he,ab as de,gs as Re,ir as Y,od as fe,st as Te,tt as Ee,vk as be,wk as ye,wt as xe,xb as pe,xk as E,yk as x}from"chunk-LIUGL3AW.mjs";import{a as le,b as ce,j as ue,m as me}from"chunk-CMAEAGWD.mjs";import{a as te,b as q}from"chunk-JB2N3EQZ.mjs";import{da as w,ia as se}from"chunk-EEV263O3.mjs";import{a as ae}from"chunk-YOOGIIWU.mjs";import{e as T}from"chunk-AHQIRSXG.mjs";var I=T(te(),1);var ne=T(q(),1),V=class e{constructor(t){this.result=t;Object.assign(this,t)}isCanceled(){return!this.result.ok&&this.result.error==="cancelled"}isEmpty(){return!this.result.ok&&this.result.error==="empty"}isFiles(){return this.result.ok&&Array.isArray(this.result.value)&&this.result.value.length>0}static canceled(){return new e(re("cancelled"))}static empty(){return new e(re("empty"))}static files(t){return new e(Me(t))}};function rt(e){return e.startsWith("text")||e==="application/json"}function nt(e,t,o){let n=e/1e6;return rt(o)?n<=t:!0}function it({disabled:e,name:t,maxSizeInMB:o,shouldCheckFileSize:n,onMaxSizeExceeded:i,performantLimitInMB:s=5},l){let d=(0,I.useRef)(null),a=(0,I.useRef)(null),r=(0,I.useRef)(null);(0,I.useImperativeHandle)(l,()=>({show(m,f){return new Promise((y,u)=>{if(r.current){let[,g]=r.current;g(Error("Multiple calls to show()"))}if(r.current=[y,u],(!window.event||!window.event.isTrusted)&&console.warn("FilePicker\u2018s show() must be called from trusted event"),!a.current){r.current=null,y(V.canceled());return}m?a.current.accept=m.join(","):a.current.removeAttribute("accept"),f?a.current.multiple=!0:a.current.removeAttribute("multiple"),a.current.click()})}}));let c=(0,I.useCallback)(m=>{if(!r.current)return;let[f]=r.current;r.current=null;let{files:y}=m.currentTarget;if(!y||y.length===0){f(V.empty());return}let u=[];for(let g of y)o===void 0||nt(g.size,o,g.type)?(g.size/1e6>s&&g.type==="application/json"&&J({type:"add",variant:"warning",key:"file-picker-large-file-detected",primaryText:"Adding large files",secondaryText:"can impact performance.",duration:6e3,action:{title:"OK",onClick:()=>J({type:"remove",key:"file-picker-large-file-detected"})}}),u.push(g)):i?i(g.size/1e3):J({type:"add",variant:"error",primaryText:"Exceeded max file size",secondaryText:`of ${o} MB.`});u.length>0?f(V.files(u)):f(V.empty()),d.current?.reset()},[o,i,n]),[p,b]=(0,I.useState)(null),L=(0,I.useCallback)(m=>{a.current=m,b(m)},[]);return(0,I.useEffect)(()=>{if(!p)return;let m=new AbortController;return p.addEventListener("cancel",()=>{if(!r.current)return;let[f]=r.current;r.current=null,f(V.canceled())},{signal:m.signal}),()=>{m.abort()}},[p]),(0,ne.jsx)("form",{ref:d,style:{display:"none"},children:(0,ne.jsx)("input",{disabled:e,name:t,onChange:c,ref:L,style:{display:"none"},type:"file"})})}var Pt=(0,I.forwardRef)(it);var M=T(te(),1);var at=w("usePreloadedScope");function Ae(e,t){if(!t||!ce(e))return;let o=t.tree.get(e);!ke(o)||o.isLoaded()||(at.debug("Loading scope node",e),o.load())}function kt(e){let t=Le();(0,M.useEffect)(()=>Ae(e,t),[e])}function Oe(e){let t=(0,M.useContext)(Pe);(0,M.useEffect)(()=>Ae(e,t),[e,t])}function X(e,t,o){return e.replace(de,(n,i)=>i===t.id?o.slug:`:${t.name.toLowerCase()}`)}function He(e,t,o,n="Home",i){let s=E(t)&&!i?Fe(t):void 0,l=E(t)?Ue(e,t):null;if(!t||!be(t)||!l)return;let d="";if(o&&o!==he){let r=e.root.getNonDefaultLocale(o);r?.slug&&(d="/"+r.slug)}if(l.id===e.root.homePageNodeId)return d?d+"/":n;let a=xe(e,l);if(a){if(s?.identifier){let r=oe(e,s.identifier);if(r){let c=D(e,o),b=r.getItemToSlug(c)[s.collectionItemId];if(b){let L=r.getSlugVariable();if(L){let m={id:s.collectionItemId,slug:b};return d+X(a,L,m)}}}return}if(fe(l)&&l.dataIdentifier){let r=oe(e,l.dataIdentifier);if(r&&!s){let c=r.getSlugVariable();if(c){let p=D(e,o),b=r.getItemToSlug(p);return d+Te(a,b,c)}}}return d+a}}function ze(e){Oe(E(e)?e.webPageId:void 0)}var P=T(te(),1);var $e="cjpnope";var N=T(q(),1),lt=/\W+/u;function ct(e){return new Set(e.split(lt))}function ut(e,t,o){return(0,P.useMemo)(()=>{let n=new Set;if(!e||!t)return n;for(let i of o.keys()){let s=t.get(i);!s||!ve(s).every(a=>{if(!a)return!1;for(let r of e)if(r.endsWith(a))return!0;return!1})||n.add(i)}return n},[e,t,o])}var go=({tree:e,link:t,localeId:o,hideSlugValues:n=!1,homePageName:i="Home",variableInfo:s,...l})=>{ze(t);let d=Re(e),a=D(e,o),r=Se(e).getWebPageIdToRawPathMap(e),c=e.root.getDataIdentifierByWebPageIdMap(),p=d?.getSlugVariableByIdentifierMap(),b=d?.getItemToSlugByIdentifierMap(a),L=Ie(t,r),m=ye(t)?t.url:"",f=L?"":m,y=He(e,t,o,i,n)??f,u=s?.ids,g=ut(u,r,c);return(0,N.jsx)(mt,{...l,link:t,readableLink:y,homePageName:i,variableInfo:s,hideSlugValues:n,webPageIdToRawPathMap:r,dataIdentifierByWebPageIdMap:c,slugVariableByIdentifierMap:p,itemToSlugByIdentifierMap:b,collectionPagesWithVariablesInScope:g,routerLocale:a,selectedPageMissing:L})},mt=(0,P.memo)(function({id:t,placeholder:o,link:n,onChange:i,constantChange:s,rightChevron:l,supportsPageLinks:d,hideSlugValues:a,supportsVariables:r,variableInfo:c,autoFocus:p,className:b,enabled:L,readOnly:m,tabIndex:f,onMouseDown:y,homePageName:u,onClear:g,menuOffset:v,menuWidth:h,menuClassName:S,onOpenChange:C,backdropEnabled:R,linkListStickySectionHeaders:k,hasError:B,onBlur:Z,webPageIdToRawPathMap:F,dataIdentifierByWebPageIdMap:U,slugVariableByIdentifierMap:A,itemToSlugByIdentifierMap:O,collectionPagesWithVariablesInScope:j,routerLocale:H,readableLink:z,selectedPageMissing:Ye}){let ie=Ye||!!B,[_,Je]=(0,P.useState)(()=>qe(z)),$=(0,P.useMemo)(()=>Ke({webPageIdToRawPathMap:F,dataIdentifierByWebPageIdMap:U,slugVariableByIdentifierMap:A,itemToSlugByIdentifierMap:O,collectionPagesWithVariablesInScope:j,routerLocale:H,homePageName:u,variableInfo:c,collectionPageType:a?"noSlugInScope":"showSlugValues"}),[F,U,A,O,j,H,u,c,a]),K=(0,P.useMemo)(()=>Ke({webPageIdToRawPathMap:F,dataIdentifierByWebPageIdMap:U,slugVariableByIdentifierMap:A,itemToSlugByIdentifierMap:O,collectionPagesWithVariablesInScope:j,routerLocale:H,homePageName:u,variableInfo:c,collectionPageType:"slugInScope"}),[F,U,A,O,j,H,u,c]),Qe=(0,P.useCallback)((W,ee)=>{if(ee||s){if(W===z)return;let ot=$.get(W)??K.get(W)??x({url:W});if(i(ot,ee),ee)return}let tt=qe(W);Je(tt)},[s,z,$,K,i]),Ge=(0,P.useMemo)(()=>gt($,K,_),[$,K,_]),Xe=!!c?.idOfMutableVariableProvider,Ze=r&&Xe,_e=(0,P.useContext)(We)===null,[et]=(0,P.useState)(()=>(me(n)||ue(n)||ge(n))&&!Ze&&_e);return(0,N.jsx)(Be,{id:t,clearSelectionOnEmptySearch:!0,autoCompleteEnabled:d,showAllWhenOpened:E(n),tabIndex:f,onMouseDown:y,searchItemValue:!!_,items:Ge,value:z,placeholder:o||dt(n,ie,d),constantChange:!0,rightChevron:l,onChange:Qe,autoFocus:le(p)?p:et,menuOffset:v,enabled:L,readOnly:m,hasError:ie,getSearchTokens:ct,wrapperClassName:b,onBlur:Z,rightSlot:g?(0,N.jsx)(we,{variant:"clean",type:"button",className:$e,onClick:g,title:"Remove Link",children:(0,N.jsx)(Ve,{})}):void 0,onOpenChange:C,backdropEnabled:R,menuWidth:h,menuClassName:S,stickySectionHeaders:k,containOverscroll:!0})});function dt(e,t,o){return t?"Missing":se(e)?"Multiple\u2026":o?"Page or URL\u2026":"URL\u2026"}function pt(e,t){if(e.variableSourceIdentifiers)for(let o in e.variableSourceIdentifiers){if(e.variableSourceIdentifiers[o]===t)return o;let n=e.combined.get(o);if(n){for(let[,i]of n)if(i.type==="collectionreference"&&i.dataIdentifier===t)return o}}}function Ke({webPageIdToRawPathMap:e,dataIdentifierByWebPageIdMap:t,slugVariableByIdentifierMap:o,itemToSlugByIdentifierMap:n,collectionPagesWithVariablesInScope:i,routerLocale:s,variableInfo:l,homePageName:d,collectionPageType:a}){let r=new Map;if(!e||a==="slugInScope"&&i.size===0)return r;let c=s.slug?`/${s.slug}`:"";for(let[p,b]of e.entries()){let L=b==="/",m=Y(b);if(L){if(a==="slugInScope")continue;let h=x({webPageId:p}),S=c?c+m:d??m;r.set(S,h);continue}let f=t.get(p);if(!f){if(a==="slugInScope")continue;let h=x({webPageId:p});r.set(c+m,h);continue}let y=o?.get(f);if(!y)continue;let u=y.id,g=u;if(l&&!l.ids.has(u)){for(let h of l.ids)if(Ce(h,u)){g=h;break}}let v=n?.get(f);if(a==="slugInScope"||a==="noSlugInScope"){let h=i.has(p),S=Y(Ee(b,y));if(a==="slugInScope"&&h){ae(l,"variableInfo should exist when inScope");let C=pt(l,f),R=C?{[u]:pe(g,C)}:void 0,k=x({webPageId:p,pathVariables:R});r.set(c+S,k)}else if(a==="noSlugInScope"&&!h){if(!v)continue;let C=Ne(v);if(!C)continue;let[R,k]=C,B={identifier:f,collectionItemId:R,key:u,value:k},Z=x({webPageId:p,pathVariables:{[u]:B}});r.set(c+S,Z)}continue}if(v)for(let h of Object.keys(v)){let S=v[h];if(!S)continue;let R=Y(X(b,y,{id:h,slug:S})),k={identifier:f,collectionItemId:h,key:u,value:S},B=x({webPageId:p,pathVariables:{[u]:k}});r.set(c+R,B)}}return r}function qe(e){let t=e.trim(),o=t.indexOf("/:");o!==-1&&(t=t.substring(o));let n=t.split("/").filter(Boolean);for(;n.length>0;){let i=n.join("/")+"/",s="/"+i;if(t.startsWith(s)||t.startsWith(i))return s;n.pop()}return null}var ft=/\/$/u;function gt(e,t,o){let n=[],i=Array.from(e.keys()),s=Array.from(t.keys());if(o){let l=[];[...s,...i].forEach(r=>{if(!r.startsWith(o))return;let c=r.replace(o,".../");l.push({type:"option",value:r,title:c})});let a=o.replace(ft,"");return n.push({type:"section",value:a,title:a,items:l}),n}return s.length>0&&n.push({type:"section",value:"CMS",items:s.map(l=>({type:"option",value:l}))}),i.length>0&&n.push({type:"section",value:"Pages",items:i.map(l=>({type:"option",value:l}))}),n}var ht=w("invite");async function So(e,t){try{let o=await Q.post(`/web/projects/${e}/acl`,{...t,permissions:t.permissions??void 0});return{status:0,aclEntry:{...o,kind:o.pending?"invite":"user"}}}catch(o){return G(o)?{status:1,editorLimit:o.data.editorLimit,licenseType:o.data.licenseType,teamId:o.data.teamId,teamName:o.data.teamName}:(ht.reportError(o),{status:o instanceof De&&o.isTemporary?2:3})}}var bt=w("invite");async function To(e,{id:t,role:o,permissions:n}){try{return await Q.post(`/web/projects/${e}/acl/${t}`,{role:o,permissions:n??void 0}),{status:0}}catch(i){return G(i)?{status:1,editorLimit:i.data.editorLimit,licenseType:i.data.licenseType,teamId:i.data.teamId,teamName:i.data.teamName}:(bt.reportError(i),{status:2})}}var Vo=()=>({icon:null,title:void 0,body:"No Search Results"});export{He as a,kt as b,ze as c,go as d,So as e,To as f,Vo as g,Pt as h};
//# sourceMappingURL=chunk-TMW6MU5R.mjs.map
