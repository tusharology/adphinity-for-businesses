import{Gt as N,It as P,Or as H,eg as b,w as l}from"chunk-LIUGL3AW.mjs";import{a as C,f as m,g as S,j as h}from"chunk-CMAEAGWD.mjs";import{a as f}from"chunk-YOOGIIWU.mjs";function w(d){let o=[];for(let e of d){let{class:t,properties:n,...r}=e,i={...r,properties:JSON.parse(JSON.stringify(n))};e.type==="shader"&&b(t)&&Object.assign(i,{fragment:t.fragment,vertex:t.vertex}),o.push(i)}return o}function j(){l.frame.addScope("is-hidden",1500),l.component.addScope("is-hidden",1500)}function v(){l.frame.removeScope("is-hidden"),l.component.removeScope("is-hidden")}function u(d,o,e){if(h(d.hidden))return!1;if(C(d.hidden))return d.hidden;try{j();let t=d.hidden(o,e);return v(),t}catch{return v(),!1}}var R=class{constructor(o,e){this.componentLoader=o;this.engine=e}async getHiddenStateForControlsByNode(o){let e={};return Object.entries(o).forEach(([t,{controlNames:n}])=>{let r=this.engine?.tree.getNode(t);if(!r)return;f(H(r),"Node is not a CanvasNode with control props (node.__class: ",r.__class,")");let i=r.getControlPropSourceIdentifier();f(i,"Cannot find component identifier for node");let s=this.componentLoader.getPropertyControlsForIdentifier(i);if(!s)return;let a=n??Object.keys(s),c=r.getResolvedControlPropValues(this.componentLoader);e[t]=x(a,s,c)}),e}async getHiddenStateForActionControls({actionIdentifier:o,controlNames:e,actionProps:t}){f(o,"Fail to request hidden state for action controls: missing actionIdentifier");let n=this.componentLoader.componentForIdentifier(o);return e.reduce((i,s)=>{let a=n?n.properties[s]:void 0;return a?(i[s]=u(a,t,t),i):(i[s]=!1,i)},{})}async getHiddenStateForModuleControls({moduleIdentifier:o,controlNames:e,moduleProps:t}){let n=this.componentLoader.getPropertyControlsForIdentifier(o);if(!n)return{};let r=P({assetResolverWithHash:null,variableValueResolver:{getVariableReferenceValue(){throw new Error("getVariableReferenceValue is not implemented for ControlsVisibilityServiceImplementation")}},getResolvedFetchDataValue:void 0,getVariableControlByReference(){throw new Error("getVariableControlByReference is not implemented for  ControlsVisibilityServiceImplementation")},getCanvasTree:()=>this.engine?.tree,componentLoader:this.componentLoader});return x(e??Object.keys(n),n,N(n,t,r))}};function y(d,o,e,t,n,r){let i=d+o;if(e){if(e.hidden&&(r[i]=u(e,t,n)),e.type==="object"){let s=t[o];if(!m(s))return;for(let a in e.controls){let c=e.controls[a];y(i+".",a,c,s,n,r)}}if(e.type==="array"&&e.control.type==="object"){let s=t[o];if(!S(s))return;let a=s.length;for(let c=0;c<a;c++){let p=s[c];if(m(p))for(let g in p){let I=e.control.controls[g];y(i+`[${c}].`,g,I,p,n,r)}}}}}function x(d,o,e){let t={};for(let n of d){let r=o[n];y("",n,r,e,e,t)}return t}export{w as a,R as b};
//# sourceMappingURL=chunk-7CRGA4KR.mjs.map
