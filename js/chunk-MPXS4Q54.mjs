import{a as R}from"chunk-67PXYNDJ.mjs";import{b as m}from"chunk-YQXRHNKK.mjs";import{L as U}from"chunk-VHBQVA4D.mjs";import{a as A}from"chunk-7GSEC7H4.mjs";import{c as v}from"chunk-N42NUTZC.mjs";import{rg as I}from"chunk-SF5446RK.mjs";import{f as c,j as f,k as w}from"chunk-RT6MD2HE.mjs";import{W as u,da as h}from"chunk-EEV263O3.mjs";import{a as p}from"chunk-YOOGIIWU.mjs";var B=({naturalWidth:o,naturalHeight:e})=>({nonZeroNaturalWidth:o===0?300:o,nonZeroNaturalHeight:e===0?150:e});var L={cm:96/2.54,mm:96/2.54/10,Q:96/2.54/40,in:96,pc:96/6,pt:96/72,px:1,em:16,ex:8,ch:8,rem:16};function y(o){if(!o)return null;let e=/(-?[\d.]+)([a-z%]*)/u.exec(o);if(!e)return null;let[t,i,n]=e;if(i===void 0||n?.startsWith("%"))return null;let a=Math.round(parseFloat(i)*(n&&L[n]||1));return a<=0?0:a}function X(o){let e=_(o);if(!e)throw Error("Invalid SVG");let t=y(e.getAttribute("width")),i=y(e.getAttribute("height"));if(t!==null&&i!==null)return{width:t,height:i};let n=e.getAttribute("viewBox");if(n){let a=n.split(" "),r=y(a[2]),s=y(a[3]);if(r!==null&&s!==null){let l=s!==0?r/s:2;return t!==null&&i===null?{width:t,height:t/l}:i!==null&&t===null?{width:i*l,height:i}:{width:r,height:s}}}return{width:t??300,height:i??150}}function _(o){let e=I(o,"image/svg+xml"),t=e.rootElement||e.childNodes[0];if(!(!t||t.nodeName.toUpperCase()!=="SVG"))return t}var N=5e4,W='xlink:href="data:image/',b=/xlink:href=['"]data:image\/[^;]+;base64,([A-Za-z\d+=/]+)/gu;function Q(o){return o.length>N||o.includes(W)}function E(o){let e=0,t;for(;t=b.exec(o);){let[,i]=t;p(i,"The image regex must have a capture group for the image base64 data"),e+=i.length}return b.lastIndex=0,e<50*1024?!1:(m({key:"svg-large-raster-image",type:"add",variant:"error",primaryText:"SVGs with raster images",secondaryText:"are not supported.",duration:5e3,extraAction:{title:"Learn more",onClick(){U("https://www.framer.com/help/articles/understanding-and-fixing-the-svgs-with-large-images-inside-are-not-supported-error/")}}}),!0)}async function F(o){try{let e=document.createElement("video");e.src=URL.createObjectURL(o),await new Promise(n=>{e.addEventListener("loadedmetadata",()=>{n()})});let{videoWidth:t,videoHeight:i}=e;return{width:t,height:i}}catch{return m({variant:"warning",icon:"warning",duration:5e3,primaryText:"Couldn\u2019t get video size.",secondaryText:"Using defaults.",type:"add"}),{width:300,height:300}}}var C=h("createService");function P(o){let e=n=>{throw Error("createService Promise not set up")},t=new Promise(n=>{e=a=>{n(a),e=r=>{C.warn("Services must only be initialized once, but createService resolve was called twice for promise",t)}}});return{service:new Proxy({},{get:(n,a)=>{let r=new Error("Waiting for service timed out");return(...s)=>{let l;return new Promise((d,g)=>{o!==void 0&&(l=window.setTimeout(()=>{g(r)},o*1e3)),t.then(x=>{window.clearTimeout(l),typeof x[a]=="function"?d(x[a](...s)):d(x[a])}).catch(g)})}}}),resolve:e}}var S=h("ChooseFileService");function D(o){return o.type==="image"}function ue(o){return o.type==="video"}function V(o){let e=o.properties?.image?.width,t=o.properties?.image?.height;return p(e!==void 0&&t!==void 0,"Image asset missing width/height"),{naturalWidth:e,naturalHeight:t}}var T=class{constructor(e,t){this.api=e;this.assetService=t}async deleteAssets({keys:e}){await this.api.deleteAssets(e),this.assetService.deleteProjectAssets(e)}async uploadImage(e,{silent:t=!1,maxFileSize:i,onExceedsCustomMaxSize:n,refreshAssetService:a=!0}={}){try{let r=t?A:l=>m(l);if(!v.includes(e.type)){r({variant:"error",icon:"error",duration:1/0,primaryText:"Unsupported image type.",secondaryText:"Try png or jpg.",type:"add"});return}if(e.type==="image/svg+xml"){let l=await e.text();if(E(l))return}let s=await this.api.uploadAsset(e,{maxFileSize:i,onExceedsCustomMaxSize:n,onToast:r});return s?(a&&await this.assetService.refresh().catch(u),{type:"image",asset:s,filename:c(s),originalFilename:s.name,url:f(s),imageSize:V(s)}):void 0}catch(r){if(t)throw r;m({variant:"error",icon:"error",duration:1/0,primaryText:"Couldn\u2019t add image.",secondaryText:"It may be too large.",type:"add"}),S.reportError(r,{fileName:e.name,fileSize:e.size,fileType:e.type})}}async uploadVideo(e,{silent:t=!1,maxFileSize:i,onExceedsCustomMaxSize:n,refreshAssetService:a=!0}={}){try{let r=t?A:g=>m(g),s=await Promise.all([O(F(e),1e4,"Measuring the video took more than 10 seconds"),this.api.uploadAsset(e,{maxFileSize:i,onExceedsCustomMaxSize:n,onToast:r})]);if(!s)return;let[l,d]=s;return d?(a&&await this.assetService.refresh().catch(u),{type:"video",asset:d,filename:c(d),dimensions:l,originalFilename:d.name,url:f(d)}):void 0}catch(r){if(t)throw r;m({variant:"error",icon:"error",duration:1/0,primaryText:"Couldn\u2019t add video.",secondaryText:"Please retry.",type:"add"}),S.reportError(r,{fileName:e.name,fileSize:e.size,fileType:e.type})}}async uploadAssetByURL(e,{silent:t=!1,refreshAssetService:i=!0}={}){let n=w(e),r=(n&&this.assetService.getAssetByFilename(n.filename))??await this.api.uploadAssetByURL(e,t?void 0:m),s={asset:r,filename:c(r),originalFilename:r.name,url:f(r)};return i&&await this.assetService.refresh().catch(u),r.mimeType.startsWith("image/")?{...s,type:"image",imageSize:V(r)}:{...s,type:"file"}}async uploadFile(e,{silent:t=!1,maxFileSize:i,onExceedsCustomMaxSize:n,refreshAssetService:a=!0}={}){let r=await this.api.uploadAsset(e,{maxFileSize:i,onExceedsCustomMaxSize:n,onToast:t?void 0:s=>m(s)});if(r)return a&&await this.assetService.refresh().catch(u),{type:"file",asset:r,filename:c(r),originalFilename:r.name,url:f(r)}}async uploadFonts(e,{refreshAssetService:t=!0}={}){let i=[];if(!e)return i;try{for(let n of e){let a=await R(n.content,n.originalFilename),r=await this.api.uploadAsset(a);!r||!r.properties||i.push({filename:c(r),originalFontName:r.name,properties:r.properties.font})}t&&await this.assetService.refresh().catch(u)}catch(n){S.warn("Failed to add font:",n)}return i}async uploadImageByURL(e,{refreshAssetService:t=!0}={}){let i=[];if(!e)return i;try{let n=await this.uploadAssetByURL(e.url,{refreshAssetService:t});p(D(n)),i.push(n)}catch(n){S.warn("Failed to add image by URL:",n)}return i}},{service:ce,resolve:H}=P();function pe(o,e){H(new T(o,e))}function O(o,e,t="timed out"){return new Promise((i,n)=>{setTimeout(()=>{n(Error(t))},e),o.then(i,n)})}export{B as a,P as b,X as c,_ as d,Q as e,D as f,ue as g,ce as h,pe as i};
//# sourceMappingURL=chunk-MPXS4Q54.mjs.map
