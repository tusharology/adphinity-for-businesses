import{Ad as Y,Bd as k,sd as R}from"chunk-TO3PG6NS.mjs";import{b as O}from"chunk-K2O2DWCZ.mjs";import{Rc as J,we as Q,ze as X}from"chunk-NYFEUS7P.mjs";import{f as P}from"chunk-6Z2W7ESM.mjs";import{H as V,jh as q,kj as H}from"chunk-G5CI4O4F.mjs";import{Ad as y,Or as G,Sd as E,Ud as W,Wp as h,cc as b,ed as j,fe as D,od as T,pp as U,ud as B,vd as L,zd as S}from"chunk-LIUGL3AW.mjs";import{e as _,f as w,h as A,k as F}from"chunk-CMAEAGWD.mjs";import{W as v}from"chunk-EEV263O3.mjs";import{a as f,b as z}from"chunk-YOOGIIWU.mjs";function re(a,t,o){let l=a.reactComponentForIdentifier(t.codeComponentIdentifier);if(!l)return;let n=l.properties[o.controlPropKey];return n?h(n,t.getRawControlProp(o.controlPropKey))??void 0:void 0}function ae(a,t,o){if(!U(t))return;let l=a.reactComponentForIdentifier(t.layoutTemplateIdentifier);if(!l)return;let n=l.properties[o.controlPropKey];return n?h(n,t.getRawControlProp(o.controlPropKey))??void 0:void 0}function ne(a,t,o,l){let c=a.getNodeParent(o).getPropertyControls(a,t)[l.controlPropKey];if(!c)return;let r=o.getControlProp(l.controlPropKey);return h(c,r)??void 0}function Z(a,t,o,l){if(T(o,!0))return ae(t,o,l);if(y(o))return ne(a,t,o,l);if(L(o))return re(t,o,l)}function I(a,t,o,l){let n=Z(a,t,o,l);if(!n)return;if(!l.ancestorControlKeyPath)return n;let e=R(l.ancestorControlKeyPath);for(let c of e){if(!n)return;if(f(n.type===c.type),n.type==="object"){if(f(c.type==="object"),!w(n.value))return;n=n.value[c.key]}else if(n.type==="array"){if(f(c.type==="array"),!A(n.value))return;n=n.value.find(r=>r.id===c.id)}else{return}}return n}function N(a,t,o,l,n){if(!l.ancestorControlKeyPath){G(o)?o.setControlProp(l.controlPropKey,n):y(o)?(f(O(n),"Invalid control prop"),o.setControlProp(l.controlPropKey,n)):z(o,"Unsupported node");return}f(T(o,!0)||L(o)||y(o));function e(d){if(d)return d.type==="array"||d.type==="object"?{...d}:(f(d.type===n.type),n)}let c=e(Z(a,t,o,l));if(!c)return;let r=R(l.ancestorControlKeyPath),i=c;for(let d of r){if(!i)return;if(f(i.type===d.type),i.type==="object"){if(f(d.type==="object","Current control should be of type Object"),!w(i.value))return;let u=i.value[d.key],g=e(u);if(!g)return;i.value={...i.value,[d.key]:g},i=g}else if(i.type==="array"){if(f(d.type==="array","Current control should be of type Array"),!A(i.value))return;let u=i.value.find(C=>C.id===d.id),g=e(u);if(!g)return;i.value=i.value.map(C=>C.id===g.id?g:C),i=g}else{return}}T(o,!0)||L(o)?o.setControlProp(l.controlPropKey,c):y(o)?(f(O(c),"Invalid control prop"),o.setControlProp(l.controlPropKey,c)):z(o,"Unsupported node")}function s(a,t,o,l){let n=t?t[a]:void 0,e=l(n,o);if(!(!t&&!e)){if(!e){f(t);let c=Object.keys(t),r=c.length;if(r===0||r===1&&c[0]===a)return;let i={...t};return delete i[a],i}return{...t,[a]:e}}}function M(a,t,o,l){function n(e){function c(r){return r.name===o.type}return{...e,transforms:e.transforms.map(r=>r.id!==o.transformId||!c(r)?r:l(r))}}if(B(t)&&b(t.textContent)){let e=n(t.textContent);t.set({textContent:e});return}if(E(t)&&b(t.formInputPlaceholder)){let e=n(t.formInputPlaceholder);t.set({formInputPlaceholder:e});return}if(L(t)){let e=I(a.tree,a.componentLoader,t,o);if(!e||(f(e.type==="string"),!b(e.value)))return;let c={...e};c.value=n(e.value),N(a.tree,a.componentLoader,t,o,c)}}function $(a,t,o,l,n){a.scheduler.process(()=>{let e=a.tree.get(t.nodeId),c=t.type;switch(c){case"string":case"richtext":case"link":{if(!y(e)&&!L(e)&&!T(e))return;let r=I(a.tree,a.componentLoader,e,t);if(!r)break;f(c===r.type);let i={...r},d=s(o.id,r.valueLocalized,"default",n);i.valueLocalized=d,N(a.tree,a.componentLoader,e,t,i);break}case"slug":{if(!y(e))return;let r=I(a.tree,a.componentLoader,e,t);f(r?.type==="string","expected slug control type to be a ControlType.String");let i={...r},d=s(o.id,r.valueLocalized,"default",n);i.valueLocalized=d,N(a.tree,a.componentLoader,e,t,i);break}case"image":{if(!y(e)&&!L(e)&&!T(e))return;let r=I(a.tree,a.componentLoader,e,t);if(!r)break;f(c===r.type);let i={...r};if(l==="imageSrc"||l==="all"){let d=s(o.id,r.valueLocalized,"imageSrc",n);i.valueLocalized=d}if(l==="default"||l==="all"){let d=s(o.id,r.altLocalized,"default",n);i.altLocalized=d}N(a.tree,a.componentLoader,e,t,i);break}case"enum":{if(!S(e))return;let r=e.variables.map(i=>{if(i.id!==t.variableId)return i;f(i.type===t.type);let d=i.cases.map(u=>{if(u.id!==t.enumCaseId)return u;let g=s(o.id,u.nameLocalized,"default",n);return{...u,nameLocalized:g}});return{...i,cases:d}});e.set({variables:r});break}case"RootNode":case"WebPageNode":{if(!J(e))return;let r=t.key==="title"?"titleLocalized":"descriptionLocalized",i=e[r],d=s(o.id,i,"default",n);e.set({[r]:d});break}case"RichTextNode":{if(!B(e))return;let r=s(o.id,e.htmlLocalized,"default",n);e.set({htmlLocalized:r}),q(e)&&V(a)&&X(a,Q(a,[e.id])).catch(v);break}case"FrameNode":{if(!j(e))return;if(l==="imageSrc"||l==="all"){let r=s(o.id,e.fillImageLocalized,"imageSrc",n);e.set({fillImageLocalized:r})}if(l==="default"||l==="all"){let r=s(o.id,e.altAttributeLocalized,"default",n);e.set({altAttributeLocalized:r})}break}case"nodeLink":{if(!H(e))break;let r=s(o.id,e.linkLocalized,"default",n);e.set({linkLocalized:r});break}case"prefix":case"suffix":{if(!e)break;M(a,e,t,r=>{let i={...r},d=s(o.id,r.valueLocalized,"default",n);return i.valueLocalized=d,i});break}case"convertFromBoolean":{if(!e)break;M(a,e,t,r=>{let i={...r};return t.property==="truthy"&&(i.truthyLocalized=s(o.id,r.truthyLocalized,"default",n)),t.property==="falsy"&&(i.falsyLocalized=s(o.id,r.falsyLocalized,"default",n)),t.property==="fallback"&&r.fallback&&(i.fallback={...r.fallback,valueLocalized:s(o.id,r.fallback.valueLocalized,"default",n)}),i});break}case"convertFromEnum":{if(!e)break;M(a,e,t,r=>{let i={...r};return t.isDefaultCase?(i.defaultLocalized=s(o.id,r.defaultLocalized,"default",n),i):(i.cases=r.cases.map(d=>{if(d.id!==t.caseId)return d;let u={...d},g=s(o.id,d.toLocalized,"default",n);return u.toLocalized=g,u}),i)});break}case"FormPlainTextInputNode":{if(!E(e))return;e.set({formInputPlaceholderLocalized:s(o.id,e.formInputPlaceholderLocalized,"default",n)});break}case"FormSelectNode":{if(!W(e)||!e.formSelectOptions)return;let{optionId:r}=t,i=e.formSelectOptions.map(d=>{if(d.id!==r)return d;let u=s(o.id,d.titleLocalized,"default",n);return{...d,titleLocalized:u}});e.set({formSelectOptions:i});break}case"formSelectGenericOption":{if(!W(e))return;let{key:r}=t;switch(r){case"allItemsLabel":{let i=s(o.id,e.allItemsLabelLocalized,"default",n);e.set({allItemsLabelLocalized:i});break}case"booleanTrueLabel":{let i=s(o.id,e.booleanTrueLabelLocalized,"default",n);e.set({booleanTrueLabelLocalized:i});break}case"booleanFalseLabel":{let i=s(o.id,e.booleanFalseLabelLocalized,"default",n);e.set({booleanFalseLabelLocalized:i});break}default:z(r)}break}case"RouteSegmentNode":{if(!D(e))return;let r=e.segmentLocalized,i=s(o.id,r,"default",n);e.set({segmentLocalized:i});break}default:}})}function ie(a,t){switch(t){case"default":return a.hash;case"imageSrc":return f(k(a)),a.imageHash;default:z(t)}}function le(a,t){if(!t.draft)return;let o=a.stores.localizationStore.progressPerLocale[t.id];!_(o)||o===1||a.scheduler.runBeforeNextFrame(()=>{a.stores.localizationStore.progressPerLocale[t.id]===1&&a.stores.modalStore.set({type:"LocaleReady",activeLocale:t,source:"automatic"})})}function ee(a,t,o,l,n){let{needsReview:e,generatedByAI:c,pluginId:r,pluginMode:i,ignoreTracking:d,target:u="default",trackingSource:g,preserveExistingTextType:C}=n;if($(a,o,l,u,m=>{let p={value:t,hash:ie(o,u),lastEdited:Date.now()};if(u==="imageSrc"&&("imageFocalPoint"in n?n.imageFocalPoint&&(p.imageFocalPoint=n.imageFocalPoint):m?.imageFocalPoint&&(p.imageFocalPoint=m.imageFocalPoint)),C)if(u==="default"){let x=o.localizedValues[l.id],te=x?.value??null;f(te===t,"The text type can only be preserved when the source value is unchanged"),x?.type&&(p.type=x.type)}else u==="imageSrc"||z(u);else Y(o)&&(p.type="rich-text");e&&(p.needsReview=!0);let K=m?.value===t;return(c||K&&m?.generatedByAI)&&(p.generatedByAI=!0),r||F(i)?(f(r&&F(i),"Cannot set only pluginId or pluginMode"),p.pluginId=r,p.pluginMode=i):K&&m?.pluginId&&(p.pluginId=m.pluginId,m?.pluginMode&&(p.pluginMode=m.pluginMode)),d||P(m?"localized_value_update":"localized_value_create",{code:l.code,valueLength:t?t.length:0,generatedByAI:!!p.generatedByAI,source:g}),p}),V(a)&&le(a,l),V(a)&&a.stores.chromeStore.isPreviewingLocaleOnCanvas){let m=a.tree.get(o.nodeId);if(S(m)||y(m)){let p=S(m)?m.id:m.parentid;if(!p)return;a.stores.codeGenerationStore.updateComponent(p).catch(v)}}}function oe(a,t){let o=a.localizedValues[t.id];return o?o.value:null}function we(a,t,o,l){let n="default",e=oe(t,o),c=t.localizedValues[o.id];if(k(t)){let r=t.imageLocalizedValues[o.id];r&&(n="imageSrc",e=r.value,c=r)}ee(a,e,t,o,{needsReview:!0,ignoreTracking:!0,target:n,trackingSource:l,preserveExistingTextType:!0}),P("localized_value_request_review",{code:o.code,valueLength:e?e.length:0,generatedByAI:!!c?.generatedByAI,source:l})}function Ae(a,t,o,{trackingSource:l,ignoreTracking:n}){let e="default",c=oe(t,o),r=t.localizedValues[o.id];if(k(t)){let i=t.imageLocalizedValues[o.id];i&&(e="imageSrc",c=i.value,r=i)}ee(a,c,t,o,{ignoreTracking:!0,target:e,trackingSource:l,preserveExistingTextType:!0}),n||P("localized_value_approve",{code:o.code,valueLength:c?c.length:0,generatedByAI:!!r?.generatedByAI,source:l})}function Fe(a,t,o,{target:l,ignoreTracking:n,trackingSource:e}){$(a,t,o,l,c=>{let r=c?.value;n||P("localized_value_clear",{code:o.code,valueLength:r?r.length:0,generatedByAI:!!c?.generatedByAI,source:e})})}function Oe(a){switch(a){case 2:case 5:case 6:case 4:return!0;case 0:case 1:case 3:return!1;default:z(a)}}export{ee as a,we as b,Ae as c,Fe as d,Oe as e};
//# sourceMappingURL=chunk-3UOABR2T.mjs.map
