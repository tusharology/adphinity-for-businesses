import{$c as te,Ad as re,jc as ee}from"chunk-Y4KFFISW.mjs";import{A as j,E as L,Pl as _,b as K,ba as F,ea as M,gb as J,k as U,lb as X,rf as Z,t as k,ub as Y,vb as A,y as D}from"chunk-ZXJMCM2S.mjs";import{Bc as H,Db as E,Hb as N,Ib as W,ak as B,dq as R,hc as q,tc as G,wb as V,wc as Q}from"chunk-SF5446RK.mjs";import{p as z}from"chunk-OBUCKN56.mjs";import{a as $,e as T}from"chunk-CMAEAGWD.mjs";import{a as C,b as x}from"chunk-YOOGIIWU.mjs";var I="--";function se(e){return!e.includes(I)}function De(e,t){let n=e.indexOf(I);if(n<0)return t;let l=e.slice(n);return`${t}${l}`}function ne(e,t){return`${e}${I}${t}`}function Le(e,t,n,l){return se(e)&&l===0?e:ne(e,`${t}-${n}`)}function Fe(e,t,n,l){return ne(e,`${t}-${n}-${l}`)}function Me(e){if(!e)return;let t=e.indexOf(I);return t<0?e:e.slice(0,t)}function ie(e,t,n){if(!e||!Q(e)){t.cache.parentDirected=void 0;return}t.cache.parentDirected=e.layout,H(e)&&(t.cache.parentDirectedRowHeightType=e.gridRowHeightType,t.cache.parentDirectedColumnCount=T(e.gridColumnCount)?e.gridColumnCount:void 0),q(e.stackDirection)&&n?t.cache.parentDirection=e.resolveValue("stackDirection")??G:t.cache.parentDirection=e.stackDirection??null,K(e)&&(t.cache.parentWidthType=e.widthType,t.cache.parentHeightType=e.heightType)}function We(e,t){ie(e,t,!1)}function qe(e,t){ie(e,t,!0)}function et(e,t){let n=J(X),l=A(e,n),i={},r=[],a=[],o=[],s=[];l.doc.descendants(u=>{if(k(u)){let d={blockStyles:u.attrs.blockStyles,inlineStyles:u.attrs.inlineStyles,textStylePreset:u.attrs.textStylePreset},g=i[u.attrs.tag]??[];g.push(d),i[u.attrs.tag]=g}if(D(u)){let d=!1,g=!1,m,y;for(let c of u.marks)d||=L(c),g||=M(c),j(c)&&(y??=c.attrs),F(c)&&r.push(c.attrs.linkStylePreset),U(c)&&(m=c.attrs.inlineStyles);s.push(y),d&&a.push(m),g&&o.push(m)}});let f=A(t,n),p=f.tr,h=new Map;f.doc.descendants((u,d,g)=>{if(k(u)){let m=i[u.attrs.tag]??[],y=m.length>1?m.shift():m[0];y&&(h.set(u,y.inlineStyles),p.setNodeMarkup(d,u.type,{...u.attrs,...y}))}if(D(u)){let m=!1,y=!1,c=g?h.get(g):void 0;for(let O of u.marks)if(m||=L(O),y||=M(O),F(O)){let le=r.length>1?r.shift():r[0];p.addMark(d,d+u.nodeSize,n.marks.link.create({...O.attrs,linkStylePreset:le}))}m&&(c=a.length>1?a.shift():a[0]),y&&(c=o.length>1?o.shift():o[0]),c&&p.addMark(d,d+u.nodeSize,n.marks.inlineStyles.create({inlineStyles:c}));let w=s.length>1?s.shift():s[0];w&&p.addMark(d,d+u.nodeSize,n.marks.backgroundMask.create(w))}});let v=f.apply(p);return Y(v.doc,n)}function ce(e){if(B(e))return e.type===void 0?e:{...e,type:void 0,value:re(e.value)}}function ue(e,t){if(B(e))return e.type==="rich-text"?e:{...e,type:"rich-text",value:te(t,e.value)}}function ot(e,t,n){switch(e){case"text":return ce(t);case"rich-text":return ue(t,n);default:x(e)}}var P="[a-z1-9]+(?:-[a-z1-9]+)*",pe=`${P}="[^"]*"`,fe=String.raw`(?:\s+${pe})*`,de=String.raw`<${P}${fe}\s*>`,ye=`(?:${de})+`,me=String.raw`<\/\s*${P}\s*>`,ge=`(?:${me})+`,he="[^<>]*",ae=String.raw`\s*`,Ce=new RegExp(`^${ae}${ye}${he}${ge}${ae}$`,"iu");function ct(e){return z.isOn("localizedLinks")&&e.includes("</a>")?"rich-text":Ce.test(e)?"text":"rich-text"}function xe(e){return e.getPrimaryId()}function S(e,t,n){return C(t==="boolean","Unsupported enum output type:",t),$(e)||V(e)?n(e):{type:"LiteralValue",value:R(t,void 0)}}function Te(e,t,n,l){function i(r){return V(r)?l(r):{type:"LiteralValue",value:r}}switch(C(E(e.name),`Transform is not a valid expression: ${e.name}`),e.name){case"contains":switch(n?.type){case"multicollectionreference":return{type:"BinaryOperation",operator:"in",left:i(e.value),right:t};default:return{type:"FunctionCall",functionName:"CONTAINS",arguments:[t,i(e.value)]}}case"containsAny":{let r=i(e.value),a={type:"BinaryOperation",left:{type:"FunctionCall",functionName:"LENGTH",arguments:[{type:"FunctionCall",functionName:"INTERSECT",arguments:[t,r]}]},operator:">",right:{type:"LiteralValue",value:0}},o={type:"BinaryOperation",left:{type:"FunctionCall",functionName:"LENGTH",arguments:[r]},operator:"==",right:{type:"LiteralValue",value:0}};return{type:"BinaryOperation",left:a,operator:"or",right:o}}case"containsAll":{let r=i(e.value);return{type:"BinaryOperation",operator:"==",left:{type:"FunctionCall",functionName:"LENGTH",arguments:[{type:"FunctionCall",functionName:"INTERSECT",arguments:[t,r]}]},right:{type:"FunctionCall",functionName:"LENGTH",arguments:[r]}}}case"startsWith":return{type:"FunctionCall",functionName:"STARTS_WITH",arguments:[t,i(e.value)]};case"endsWith":return{type:"FunctionCall",functionName:"ENDS_WITH",arguments:[t,i(e.value)]};case"equals":return{type:"BinaryOperation",operator:"==",left:t,right:i(e.value)};case"isSet":{let r={type:"BinaryOperation",operator:"!=",left:t,right:{type:"LiteralValue",value:null}};if(!n)return r;let a=n.type;if(!W(a))return r;switch(a){case"multicollectionreference":case"array":return{type:"BinaryOperation",operator:"and",left:r,right:{type:"BinaryOperation",operator:">",left:{type:"FunctionCall",functionName:"LENGTH",arguments:[t]},right:{type:"LiteralValue",value:0}}};case"string":case"richtext":case"date":case"link":case"image":case"file":case"collectionreference":return{type:"BinaryOperation",operator:"and",left:r,right:{type:"BinaryOperation",operator:"!=",left:t,right:{type:"LiteralValue",value:""}}};case"boolean":case"number":case"responsiveimage":return r;default:return r}}case"greaterThan":return{type:"BinaryOperation",operator:">",left:t,right:i(e.value)};case"lessThan":return{type:"BinaryOperation",operator:"<",left:t,right:i(e.value)};case"negate":return{type:"UnaryOperation",operator:"not",value:t};case"toBoolean":return{type:"TypeCast",dataType:"BOOLEAN",value:t};case"isBefore":return{type:"BinaryOperation",operator:"<=",left:{type:"TypeCast",dataType:"DATE",value:t},right:{type:"TypeCast",dataType:"DATE",value:i(e.value)}};case"isAfter":return{type:"BinaryOperation",operator:">=",left:{type:"TypeCast",dataType:"DATE",value:t},right:{type:"TypeCast",dataType:"DATE",value:i(e.value)}};case"isBetweenDates":return{type:"BinaryOperation",operator:"and",left:{type:"BinaryOperation",operator:">=",left:{type:"TypeCast",dataType:"DATE",value:t},right:{type:"TypeCast",dataType:"DATE",value:i(e.start)}},right:{type:"BinaryOperation",operator:"<=",left:{type:"TypeCast",dataType:"DATE",value:t},right:{type:"TypeCast",dataType:"DATE",value:i(e.end)}}};case"isIncludedIn":return{type:"BinaryOperation",operator:"in",left:t,right:i(e.value)};case"convertFromEnum":{if(n?.type!=="enum")return{type:"LiteralValue",value:R(e.outputType,void 0)};let r=new Set,a=[];for(let o of e.cases)r.has(o.from)||n.options.includes(o.from)&&(r.add(o.from),a.push({type:"Condition",when:{type:"LiteralValue",value:o.from},then:S(o.to,e.outputType,i)}));return{type:"Case",value:t,conditions:a,else:S(e.default,e.outputType,i)}}case"convertFromString":{let r=new Set,a=[];for(let o of e.cases)r.has(o.from)||(r.add(o.from),a.push({type:"Condition",when:{type:"LiteralValue",value:o.from},then:S(o.to,e.outputType,i)}));return{type:"Case",value:t,conditions:a,else:S(e.default,e.outputType,i)}}default:x(e.name)}}function Ve(e,t){if(!e.providerId)return!1;let n=t.get(e.providerId);if(!n)return!1;let l=n.get(e.id);if(!l)return!1;let i="optional";return i in l&&l[i]===!0}function ve(e,t,n,l,i,r){if(!e.collectionFilters)return;let a=e.collectionFilters.filters,o=[];for(let{itemKey:p,transforms:h}of a){let g=function(c){return Ve(c,t)&&d.push(c),i(c)};var f=g;if(!p)continue;let u=t?.get(e.getPrimaryId())?.get(p);if(!u||(n.add(p),u.type!=="boolean"&&h.length===0))continue;let d=[],m=h.some(c=>{if(!N(c.name)||!E(c.name))return!1;switch(c.name){case"convertFromEnum":case"convertFromString":case"endsWith":case"equals":case"greaterThan":case"isAfter":case"isBefore":case"isBetweenDates":case"isSet":case"lessThan":case"negate":case"startsWith":case"toBoolean":return!0;case"contains":case"containsAny":case"containsAll":case"isIncludedIn":return!V(c.value);default:x(c.name)}}),y=b(p,u,n,l,r,m);for(let c of h)N(c.name)&&(y=Te(c,y,u,g));o.push({expression:y,optionalVariables:d})}let s=e.collectionFiltersOperator??_;switch(s){case"all":return Oe(o,i);case"any":return Ie(o,i);default:x(s)}}function Oe(e,t){if(e.length!==0)return e.reduce((n,l)=>{let i=Se(l.expression,l.optionalVariables,t);return n?{type:"BinaryOperation",operator:"and",left:n,right:i}:i},void 0)}function Ie(e,t){if(e.length===0)return;let n=e.reduce((r,a)=>{let o=be(a.expression,a.optionalVariables,t);return r?{type:"BinaryOperation",operator:"or",left:r,right:o}:o},void 0);if(!e.every(r=>r.optionalVariables.length>0))return n;let i=e.flatMap(r=>r.optionalVariables);return C(i.length>0,"allUsedOptionalVariables should have at least one element"),Ee(n,i,t)}function Se(e,t,n){for(let l of t)e={type:"BinaryOperation",operator:"or",left:{type:"BinaryOperation",operator:"==",left:n(l),right:{type:"LiteralValue",value:null}},right:e};return e}function be(e,t,n){for(let l of t)e={type:"BinaryOperation",operator:"and",left:{type:"BinaryOperation",operator:"!=",left:n(l),right:{type:"LiteralValue",value:null}},right:e};return e}function Ee(e,t,n){if(!e)return;let l=t.reduce((i,r)=>{let a={type:"BinaryOperation",operator:"==",left:n(r),right:{type:"LiteralValue",value:null}};return i?{type:"BinaryOperation",operator:"and",left:i,right:a}:a},void 0);return l?{type:"BinaryOperation",operator:"or",left:e,right:l}:e}function Ne(e,t,n,l,i,r){if(e.collectionOrder&&e.collectionOrder.length>0){let a=[];for(let{itemKey:o,direction:s}of e.collectionOrder){if(!o)continue;let f=t.get(o);if(!f)continue;let p=b(o,f,n,l,r);s==="desc"&&(p.direction="desc"),a.push(p)}return a}if(e.collectionFilters&&e.collectionFilters.filters.length===1){let a=e.collectionFilters.filters.at(0);if(C(a,"filter should exist"),a.itemKey){let o=t.get(a.itemKey),s=b(a.itemKey,o,n,l,r),f=Be(e,a.transforms,s,o,i);if(f)return[f]}}return e.collectionReverse?[{type:"Identifier",name:"index",collection:l,direction:"desc"}]:[]}function Be(e,t,n,l,i){if(t.length!==1||l?.type!=="collectionreference")return;let r=t[0];if(C(r,"Transform must exist"),r.name==="isIncludedIn"&&V(r.value))return{type:"FunctionCall",functionName:"INDEX_OF",arguments:[i(r.value),n],direction:e.collectionReverse?"desc":"asc"}}function Re(e,t,n,l,i){let r={type:"Collection",data:i(e),alias:l},a=new Map;for(let o of n){let s=o.split(".");for(let f=1;f<s.length;f++){let p=s.slice(0,f).join("."),h=t.get(p);if(h?.type!=="collectionreference")continue;let v=h.dataIdentifier;a.set(p,v)}}for(let[o,s]of a){let[f,p]=oe(o,l);r={type:"LeftJoin",left:r,right:{type:"Collection",data:i(s),alias:o},constraint:{type:"BinaryOperation",operator:"==",left:{type:"Identifier",name:p,collection:f},right:{type:"Identifier",name:"id",collection:o}}}}return r}function ke(e,t,n,l,i){let r=[];for(let a of t){if(ee(a))continue;let o=e.get(a),s=b(a,o,n,l,i);(s.type!=="Identifier"||a!==s.name)&&(s.alias=a),r.push(s)}return r}function Nt(e,t,n,l,i){let r={},a=new Set,o=xe(e);e.collectionFilters&&(r.where=ve(e,t,a,o,l,i));let s=t.get(e.getPrimaryId());C(s,"Control map of repeater must exist");let f=Ne(e,s,a,o,l,i);f.length>0&&(r.orderBy=f),T(e.collectionStartOffset)&&(r.offset={type:"LiteralValue",value:e.collectionStartOffset}),T(e.collectionLimit)&&(r.limit={type:"LiteralValue",value:e.collectionLimit});let p=ke(s,n,a,o,i);return{from:Re(e.dataIdentifier,s,a,o,i),select:p,...r}}function b(e,t,n,l,i,r=!0){r&&t?.type==="collectionreference"&&!Z(e)&&(e+=".id"),n.add(e);let[a,o]=oe(e,l);return r&&t?.type==="multicollectionreference"?{type:"FunctionCall",functionName:"FLAT_ARRAY",arguments:[{type:"Select",from:{type:"Collection",data:i(t.dataIdentifier),alias:e},select:[{type:"Identifier",name:"id",collection:e}],where:{type:"BinaryOperation",operator:"in",left:{type:"Identifier",name:"id",collection:e},right:{type:"Identifier",name:o,collection:a}},orderBy:[{type:"FunctionCall",functionName:"INDEX_OF",arguments:[{type:"Identifier",name:o,collection:a},{type:"Identifier",name:"id",collection:e}]}]}]}:{type:"Identifier",name:o,collection:a}}function oe(e,t){let n=e.split(".");if(n.length===1)return[t,e];let l=n.slice(0,-1).join("."),i=n.slice(-1).join(".");return[l,i]}export{se as a,De as b,Le as c,Fe as d,Me as e,We as f,qe as g,et as h,ce as i,ue as j,ot as k,ct as l,xe as m,Re as n,ke as o,Nt as p,oe as q};
//# sourceMappingURL=chunk-E6Y5T3PM.mjs.map
